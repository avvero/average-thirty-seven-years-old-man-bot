<html>
<head>
    <title>Statistics</title>
</head>
<body>
<h2>Statistics</h2>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
     function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
    const charId = new URLSearchParams(window.location.search).get('id')
    const statistics = JSON.parse(httpGet("/statistics?id=" + charId))
    // userStatisticsData
    let userStatisticsData = {
        labels: [],
        datasets: [{
            label: '# messages',
            data: [],
            borderWidth: 1
        }]
    }
    for (const [key, value] of Object.entries(statistics["userStatistics"])) {
        userStatisticsData.labels.push(key)
        userStatisticsData.datasets[0].data.push(value.messageCounter)
    }
    // dailyStatisticsData
    let dailyStatisticsData = {
        labels: [],
        datasets: [{
            label: '# messages',
            data: [],
            borderWidth: 1
        }]
    }
    for (const [key, value] of Object.entries(statistics["dailyStatistics"])) {
        dailyStatisticsData.labels.push(key)
        dailyStatisticsData.datasets[0].data.push(value.messageCounter)
    }
</script>

<h3>User statistics</h3>
<div style="width: 1000px">
    <canvas id="userStatisticsData"></canvas>
</div>
<script>
    new Chart(document.getElementById('userStatisticsData'), {
        type: 'bar',
        data: userStatisticsData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<h3>Daily statistics</h3>
<div style="width: 1000px">
    <canvas id="dailyStatistics"></canvas>
</div>
<script>
    new Chart(document.getElementById('dailyStatistics'), {
        type: 'bar',
        data: dailyStatisticsData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

</body>
</html>